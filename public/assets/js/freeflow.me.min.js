/*! freeflow.me 26-09-2014 */
$(function(){function a(a){return 0==a?void $(".cart-quantity").hide():void $(".cart-quantity").fadeOut(250,function(){$(this).fadeIn(250),$(".cart-quantity").text(a)})}function b(){$(this).addClass("active"),$(".addtocart").off("click"),$.ajax({url:"buy/"+$(this).data("id"),type:"post",data:{size:$(this).data("size")},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}}),setTimeout(function(){$(".addtocart").removeClass("active"),$(".addtocart").on("click",b)},1e3)}function c(){var a=0;$(".product").each(function(){a+=parseFloat($(this).children(".product-line-price").text())}),country=$(".country").val(),h="US"===country?7:"CA"===country?15:"--"===country?0:26;var b=a>0?h:0;g=a+b,$(".totals-value").fadeOut(i,function(){$("#cart-subtotal").html(a.toFixed(2)),$("#cart-shipping").html(b.toFixed(2)),$("#cart-total").html(g.toFixed(2)),0==g?$(".checkout").fadeOut(i):$(".checkout").fadeIn(i),$(".totals-value").fadeIn(i)})}function d(b){var d=$(b).parent().parent(),e=parseFloat(d.children(".product-price").text()),f=$(b).val(),g=e*f;d.children(".product-line-price").each(function(){$(this).fadeOut(i,function(){$(this).text(g.toFixed(2)),c(),$(this).fadeIn(i)})}),$.ajax({url:"/buy/update/"+d.data("id"),type:"post",data:{qty:f},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}})}function e(b){var d=$(b).parent().parent();d.slideUp(i,function(){d.remove(),c()}),$.ajax({url:"/buy/remove/"+d.data("id"),type:"post",success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}})}function f(){$.ajax({url:"/buy/destroy/",type:"post",success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&($(".product").each(function(){$(this).remove()}),a(json.success))},error:function(){}})}var g,h=26,i=125;$(".addtocart").on("click",b),$(".checkout").on("click",function(){if("--"==$(".country").val())return $(".country").addClass("highlight"),$(this).addClass("animated shake"),void setTimeout(function(){$(".checkout").removeClass("animated shake")},1e3);$(".country").removeClass("highlight");var a=StripeCheckout.configure({key:stripeToken,shippingAddress:!0,billingAddress:!1,allowRememberMe:!0,zipCode:!0,image:"http://freeflow.me/assets/imgs/secure.png",token:function(a){$.ajax({url:"/buy/checkout",type:"post",data:{token:a.id,email:a.email,card:a.card},success:function(a){json=JSON.parse(a),"undefined"!=typeof json.success?(ga("send","event","buy","checkout","complete"),$(".shopping-cart").html('<h3><span>Success!</span> Check your email for your order confirmation.</h3><p>We use a 3rd party printing company to produce the freeflows. Typically orders will take 5-10 business days for a complete turnaround.</p><p>The smaller 12x12" prints ship flat. The larger 24x24" prints ship in a heavy duty tube. We will send you an email with your tracking number once it has shipped!</p>'),f()):ga("send","event","buy","checkout","error")},error:function(){ga("send","event","buy","checkout","error")}})}});return a.open({name:"Freeflow.me",description:$(".cart-quantity").text()+" print(s) ($"+g+")",amount:100*g}),!1}),$(".product-quantity input").change(function(){d(this)}),$(".product-quantity input").keyup(function(){d(this)}),$(".product-removal button").click(function(){e(this)}),$("select.country").change(function(){"--"!=$(this).val()?$(".country").removeClass("highlight"):$(".country").addClass("highlight"),c()}),c()}),$(function(){$(".download").on("click",function(){var a=$(this).data("name");ga("send","event","button","download",a)}),$(".next a").on("click",function(){ga("send","event","button","click","next")}),$(".prev a").on("click",function(){ga("send","event","button","click","prev")}),$(".extras a").on("click",function(){ga("send","event","button","click","extras")}),$(".checkout").on("click",function(){ga("send","event","button","click","checkout")}),$(".addtocart").on("click",function(){ga("send","event","button","addtocart",$(this).data("id")+"_"+$(this).data("size"))}),$(".remove-product").on("click",function(){ga("send","event","button","click","remove")})});