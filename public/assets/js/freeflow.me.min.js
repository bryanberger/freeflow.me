/*! freeflow.me 20-07-2014 */
$(function(){function a(a){return 0==a?void $(".cart-quantity").hide():void $(".cart-quantity").fadeOut(250,function(){$(this).fadeIn(250),$(".cart-quantity").text(a)})}function b(){$(this).addClass("active"),$(".addtocart").off("click"),$.ajax({url:"buy/"+$(this).data("id"),type:"post",data:{size:$(this).data("size")},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)?(console.log("Item Added!"),a(json.success)):console.log("Item Failed")},error:function(){console.log("Ajax Error!")}}),setTimeout(function(){$(".addtocart").removeClass("active"),$(".addtocart").on("click",b)},1e3)}function c(){var a=0;$(".product").each(function(){a+=parseFloat($(this).children(".product-line-price").text())}),country=$(".country").val(),h="US"===country?7:"CA"===country?15:"--"===country?0:26;var b=a>0?h:0;g=a+b,$(".totals-value").fadeOut(i,function(){$("#cart-subtotal").html(a.toFixed(2)),$("#cart-shipping").html(b.toFixed(2)),$("#cart-total").html(g.toFixed(2)),0==g?$(".checkout").fadeOut(i):$(".checkout").fadeIn(i),$(".totals-value").fadeIn(i)})}function d(b){var d=$(b).parent().parent(),e=parseFloat(d.children(".product-price").text()),f=$(b).val(),g=e*f;d.children(".product-line-price").each(function(){$(this).fadeOut(i,function(){$(this).text(g.toFixed(2)),c(),$(this).fadeIn(i)})}),$.ajax({url:"/buy/update/"+d.data("id"),type:"post",data:{qty:f},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)?(console.log("Item Quantity updated!"),a(json.success)):console.log("Item Quantity Error...")},error:function(){console.log("Ajax Error!")}})}function e(b){var d=$(b).parent().parent();d.slideUp(i,function(){d.remove(),c()}),$.ajax({url:"/buy/remove/"+d.data("id"),type:"post",success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)?(console.log("Item Removed!"),a(json.success)):console.log("Item Removed Error...")},error:function(){console.log("Ajax Error!")}})}function f(){}var g,h=26,i=125;$(".addtocart").on("click",b),$(".checkout").on("click",function(){var a,b=StripeCheckout.configure({key:stripeToken,shippingAddress:!0,billingAddress:!1,allowRememberMe:!0,zipCode:!0,token:function(a){$.ajax({url:"/buy/checkout",type:"post",data:{token:a.id,email:a.email,card:a.card},success:function(a){json=JSON.parse(a),"undefined"!=typeof json.success?(console.log("Card successfully charged!"),$(".shopping-cart").html("<h3>Success! Check your email for your order confirmation.</h3>"),f()):console.log("Success Error...")},error:function(){console.log("Ajax Error...")}})}});return b.open({name:"Freeflow piece(s)",description:a,amount:100*g}),!1}),$(".product-quantity input").change(function(){d(this)}),$(".product-quantity input").keyup(function(){d(this)}),$(".product-removal button").click(function(){e(this)}),$("select.country").change(function(){c()}),c()}),$(function(){$(".download").on("click",function(){var a=$(this).data("name");ga("send","event","button","download",a)}),$(".next a").on("click",function(){ga("send","event","button","click","next")}),$(".prev a").on("click",function(){ga("send","event","button","click","prev")}),$(".extras a").on("click",function(){ga("send","event","button","click","extras")})});