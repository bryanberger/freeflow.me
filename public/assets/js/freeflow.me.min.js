/*! freeflow.me 26-09-2014 */
$(function(){function a(a){return 0==a?void $(".cart-quantity").hide():void $(".cart-quantity").fadeOut(250,function(){$(this).fadeIn(250),$(".cart-quantity").text(a)})}function b(a,b){a.addClass("highlight"),b.addClass("animated shake"),setTimeout(function(){b.removeClass("animated shake")},1e3)}function c(){$(this).addClass("active"),$(".addtocart").off("click"),$.ajax({url:"buy/"+$(this).data("id"),type:"post",data:{size:$(this).data("size")},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}}),setTimeout(function(){$(".addtocart").removeClass("active"),$(".addtocart").on("click",c)},1e3)}function d(){var a=0;$(".product").each(function(){a+=parseFloat($(this).children(".product-line-price").text())}),country=$(".country").val(),i="US"===country?7:"CA"===country?15:"--"===country?0:26;var b=a>0?i:0,c=a*(k.value/100);h=a-c+b,$(".totals-value").fadeOut(j,function(){$("#cart-subtotal").html(a.toFixed(2)),$("#cart-discount").html("-"+c.toFixed(2)),$("#cart-shipping").html(b.toFixed(2)),$("#cart-total").html(h.toFixed(2)),0==h?$(".checkout").fadeOut(j):$(".checkout").fadeIn(j),$(".totals-value").fadeIn(j)})}function e(b){var c=$(b).parent().parent(),e=parseFloat(c.children(".product-price").text()),f=$(b).val(),g=e*f;c.children(".product-line-price").each(function(){$(this).fadeOut(j,function(){$(this).text(g.toFixed(2)),d(),$(this).fadeIn(j)})}),$.ajax({url:"/buy/update/"+c.data("id"),type:"post",data:{qty:f},success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}})}function f(b){var c=$(b).parent().parent();c.slideUp(j,function(){c.remove(),d()}),$.ajax({url:"/buy/remove/"+c.data("id"),type:"post",success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&a(json.success)},error:function(){}})}function g(){$.ajax({url:"/buy/destroy/",type:"post",success:function(b){json=JSON.parse(b),"undefined"!=typeof json.success&&$.isNumeric(json.success)&&($(".product").each(function(){$(this).remove()}),a(json.success))},error:function(){}})}var h,i=26,j=125,k={value:0,code:""};$("#applycoupon").on("click",function(){$coupon=$("#coupon"),$.ajax({url:"/buy/validate",type:"post",data:{coupon:$coupon.val()},success:function(a){json=JSON.parse(a),"undefined"!=typeof json.success&&$.isNumeric(json.success)?(k.value=json.success,k.id=$coupon.val(),$coupon.removeClass("highlight"),d()):(k.value=0,b($coupon,$coupon),d())},error:function(){k.value=0,b($coupon,$coupon),d()}})}),$(".addtocart").on("click",c),$(".checkout").on("click",function(){if("--"==$(".country").val())return void b($(".country"),$(".checkout"));$(".country").removeClass("highlight");var a=StripeCheckout.configure({key:stripeToken,shippingAddress:!0,billingAddress:!1,allowRememberMe:!0,zipCode:!0,image:"http://freeflow.me/assets/imgs/secure.png",token:function(a){$.ajax({url:"/buy/checkout",type:"post",data:{token:a.id,email:a.email,card:a.card,coupon_id:k.id,coupon_value:k.value},success:function(a){json=JSON.parse(a),"undefined"!=typeof json.success?(ga("send","event","buy","checkout","complete"),$(".shopping-cart").html('<h3><span>Success!</span> Check your email for your order confirmation.</h3><p>We use a 3rd party printing company to produce the freeflows. Typically orders will take 5-10 business days for a complete turnaround.</p><p>The smaller 12x12" prints ship flat. The larger 24x24" prints ship in a heavy duty tube. We will send you an email with your tracking number once it has shipped!</p>'),g()):ga("send","event","buy","checkout","error")},error:function(){ga("send","event","buy","checkout","error")}})}});return a.open({name:"Freeflow.me",description:$(".cart-quantity").text()+" print(s) ($"+h+")",amount:100*h}),!1}),$("#coupon").keyup(function(){$(this).removeClass("highlight")}),$(".product-quantity input").change(function(){e(this)}),$(".product-quantity input").keyup(function(){e(this)}),$(".product-removal button").click(function(){f(this)}),$("select.country").change(function(){"--"!=$(this).val()?$(".country").removeClass("highlight"):$(".country").addClass("highlight"),d()}),d()}),$(function(){$(".download").on("click",function(){var a=$(this).data("name");ga("send","event","button","download",a)}),$(".next a").on("click",function(){ga("send","event","button","click","next")}),$(".prev a").on("click",function(){ga("send","event","button","click","prev")}),$(".extras a").on("click",function(){ga("send","event","button","click","extras")}),$(".checkout").on("click",function(){ga("send","event","button","click","checkout")}),$(".addtocart").on("click",function(){ga("send","event","button","addtocart",$(this).data("id")+"_"+$(this).data("size"))}),$(".remove-product").on("click",function(){ga("send","event","button","click","remove")})});